{{- if .Values.serviceAccount.create }}
{{- $clientId := "" }}
{{- if and .Values.terraformConfig .Values.terraformConfig.enabled }}
  {{- $clientId = .Values.terraformConfig.workloadIdentityClientId }}
{{- else if .Values.serviceAccount.workloadIdentityClientId }}
  {{- $clientId = .Values.serviceAccount.workloadIdentityClientId }}
{{- end }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ .Values.serviceAccount.name }}
  labels:
    {{- include "dubai-ml.labels" . | nindent 4 }}
    app: dubai-realestate-ml
  {{- if $clientId }}
  annotations:
    azure.workload.identity/client-id: {{ $clientId }}
    azure.workload.identity/use: "true"
  {{- end }}
{{- end }}
